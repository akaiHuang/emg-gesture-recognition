# EMG 監控程式 - 序列埠連接說明

## 系統架構

```
PC ⇄ (USB/序列埠) ⇄ 藍牙接收器 ⇄ (藍牙) ⇄ EMG 腕帶
```

## 連接步驟

### 1. 插入藍牙接收器
將 USB 藍牙接收器插入電腦的 USB 埠

### 2. 確認序列埠
在 macOS 終端機執行：
```bash
ls /dev/cu.usbserial-* /dev/cu.usbmodem-*
```

你應該會看到類似：
- `/dev/cu.usbserial-0001` ← 這就是藍牙接收器！
- `/dev/tty.usbserial-0001` ← 也可以用，但 cu.* 更適合

### 3. 啟動程式
```bash
cd /Users/akaihuangm1/Desktop/handProject_1103
source venv/bin/activate
python3 main.py
```

### 4. 使用程式

#### 方法 1：快速連接（如果你已經知道序列埠）
1. 點擊「🔍 Search Serial Ports」按鈕
2. 從下拉選單選擇 `📡 /dev/cu.usbserial-0001 (USB Serial)`
3. 點擊「Connect」按鈕
4. 開始接收 EMG 資料

#### 方法 2：比較法找出正確序列埠
1. **拔掉** USB 藍牙接收器
2. 點擊「🔍 Search Serial Ports」
3. 記下序列埠列表（例如：無序列埠）
4. **插入** USB 藍牙接收器
5. 再次點擊「🔍 Search Serial Ports」
6. 新出現的序列埠就是藍牙接收器！

## 狀態指示燈說明

### 📶 USB Receiver (USB 接收器)
- 🔴 紅色：未偵測到 / 連接失敗
- 🟡 黃色：掃描中
- 🟢 綠色：已連接

### 📡 Bluetooth (藍牙功能)
- ⚪ 灰色：未使用（模擬模式）
- 🟡 黃色：掃描中 / 連接中
- 🟢 綠色：已連接
- 🔴 紅色：掃描失敗

### 📱 EMG Device (EMG 裝置)
- ⚪ 灰色：未連接
- 🟡 黃色：連接中
- 🔵 藍色：模擬模式
- 🟢 綠色：已連接
- 🔴 紅色：連接失敗

### 📊 Signal (訊號接收)
- ⚪ 灰色：未接收
- 🟢 綠色：正在接收資料

### 📈 Signal Strength (訊號強度)
顯示接收到的封包數量

## 常見問題

### Q: 找不到序列埠？
A: 
1. 確認 USB 藍牙接收器已插入
2. 嘗試拔除再插入
3. 檢查 USB 埠是否正常工作
4. 執行 `ls /dev/tty.* | grep usb` 查看所有 USB 裝置

### Q: 連接失敗？
A:
1. 確認序列埠沒有被其他程式佔用
2. 嘗試不同的鮑率（預設 115200）
3. 檢查腕帶是否已開啟並配對

### Q: 收不到資料？
A:
1. 確認腕帶已開啟
2. 檢查腕帶是否已與接收器配對
3. 檢查腕帶電量

## 技術細節

- **序列埠通信**：使用 `pyserial` 庫
- **鮑率**：115200 (可在 serial_device.py 中調整)
- **資料格式**：29-byte 封包，標頭 `0x55 0xAA 0x55`
- **封包類型**：
  - `0xAA`：EMG 資料（8 通道）
  - `0xBB`：IMU 資料（加速度計、陀螺儀）

## 開發筆記

### 重要差異
- ❌ 不要使用 `bleak` 庫掃描藍牙裝置
- ✅ 使用 `pyserial` 直接讀取序列埠
- ❌ 不需要藍牙配對
- ✅ 藍牙配對由接收器和腕帶自動處理

### 檔案結構
- `emg_monitor/serial_device.py`：序列埠裝置管理器（新增）
- `emg_monitor/device_manager.py`：BLE 裝置管理器（保留用於其他用途）
- `emg_monitor/ui/main_window.py`：主視窗 UI（已更新支援序列埠）
- `emg_monitor/data_parser.py`：封包解析器（共用）
